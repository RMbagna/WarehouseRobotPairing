<div style="width: 100%; height: 100%; position: relative; background: white; overflow: hidden">
    <!-- Top navigation bar -->
    <div style="width: 1440px; height: 94px; padding-left: 100px; padding-right: 100px; left: 0px; top: 0px; position: absolute; justify-content: space-between; align-items: center; display: inline-flex">
        <!-- Navigation links -->
        <div style="justify-content: flex-start; align-items: flex-start; gap: 52px; display: flex">
            <a href="Home-Page.html" style="text-decoration: none;">
            <div data-status="Off" style="padding-bottom: 4px; justify-content: flex-start; align-items: flex-start; gap: 10px; display: flex">
            <div style="color: #333333; font-size: 20px; font-family: Sarabun; font-weight: 400; line-height: 32px; word-wrap: break-word">Home</div>
            </div>
            </a>
            <a href="Background-Page.html" style="text-decoration: none;">
            <div data-status="Off" style="padding-bottom: 4px; justify-content: flex-start; align-items: flex-start; gap: 10px; display: flex">
            <div style="color: #333333; font-size: 20px; font-family: Sarabun; font-weight: 400; line-height: 32px; word-wrap: break-word">Background</div>
            </div>
            </a>
             <a href="https://www.clemson.edu/cecas/departments/me/research/labs/i2r.html" style="text-decoration: none;">
                <div data-status="Off" style="padding-bottom: 4px; justify-content: flex-start; align-items: flex-start; gap: 10px; display: flex">
                <div style="color: #333333; font-size: 20px; font-family: Sarabun; font-weight: 400; line-height: 32px; word-wrap: break-word">About Us</div>
            </div>
            </a>
            </div>
             <!-- Quit button -->
        <a href="End-Page.html"  style="text-decoration: none;">
      <div style="width: 129px; height: 54px; padding-left: 24px; padding-right: 24px; background: rgba(246.50, 31.84, 31.84, 0.77); border-radius: 32px; justify-content: center; align-items: center; gap: 8px; display: flex">
        <div style="flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
        <div style="justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
        <div style="color: #FAEEEE; font-size: 16px; font-family: Sarabun; font-weight: 700; line-height: 24px; word-wrap: break-word">Quit</div>
        </div>
        </div>
      </div>
      </a>
      </div>

    <!-- Main content area -->
    <div style="width: 1440px; height: 1024px; left: 0px; top: 94px; position: absolute">
        <!-- Right side content - Satisfaction buttons -->
        <div style="width: 608px; height: 1024px; left: 732px; top: 0px; position: absolute">
            <div style="width: 1036px; height: 1024px; left: -328px; top: 0px; position: absolute; background: rgba(244, 101, 48, 0.12)"></div>
            
            <!-- Trial counter -->
            <div style="left: 231px; top: 105px; position: absolute; color: #333333; font-size: 44px; font-family: Sarabun; font-weight: 700; line-height: 72px; word-wrap: break-word">
                Trial <span id="trialCounter">1</span>
            </div>
            
            <!-- Satisfaction prompt -->
            <div id="satisfactionPrompt" style="width: 555px; left: 84px; top: 261px; position: absolute; color: #333333; font-size: 28px; font-family: Sarabun; font-weight: 700; line-height: 45px; word-wrap: break-word">
                How satisfied are you with this robot pairing?
            </div>
            
            <!-- Dissatisfied button -->
            <a href="#" onclick="rateSatisfaction('Dissatisfied')" style="text-decoration:none;">
                <div style="width: 376px; height: 54px; padding-left: 24px; padding-right: 24px; left: 166px; top: 501px; position: absolute; background: #1B3360; border-radius: 32px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                    <div style="flex-direction: column; justify-content: center; align-items: center; display: flex">
                        <div style="justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                            <div style="color: white; font-size: 16px; font-family: Sarabun; font-weight: 700; line-height: 24px; word-wrap: break-word">Dissatisfied, the model is not Human-Centric</div>
                        </div>
                    </div>
                </div>
            </a>
            
            <!-- Marginally dissatisfied button -->
            <a href="#" onclick="rateSatisfaction('Marginally dissatisfied')" style="text-decoration:none;">
                <div style="width: 376px; height: 54px; padding-left: 24px; padding-right: 24px; left: 166px; top: 582px; position: absolute; background: #1B3360; border-radius: 32px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                    <div style="flex-direction: column; justify-content: center; align-items: center; display: flex">
                        <div style="justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                            <div style="color: white; font-size: 16px; font-family: Sarabun; font-weight: 700; line-height: 24px; word-wrap: break-word">Marginally dissatisfied, slightly Human-Centric</div>
                        </div>
                    </div>
                </div>
            </a>
            
            <!-- Marginally satisfied button -->
            <a href="#" onclick="rateSatisfaction('Marginally satisfied')" style="text-decoration:none;">
                <div style="width: 376px; height: 54px; padding-left: 24px; padding-right: 24px; left: 166px; top: 663px; position: absolute; background: #1B3360; border-radius: 32px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                    <div style="flex-direction: column; justify-content: center; align-items: center; display: flex">
                        <div style="justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                            <div style="color: white; font-size: 16px; font-family: Sarabun; font-weight: 700; line-height: 24px; word-wrap: break-word">Marginally satisfied, almost Human-Centric</div>
                        </div>
                    </div>
                </div>
            </a>
            
            <!-- Satisfied button -->
            <a href="#" onclick="rateSatisfaction('Satisfied')" style="text-decoration:none;">
                <div style="width: 376px; height: 54px; padding-left: 24px; padding-right: 24px; left: 166px; top: 744px; position: absolute; background: #1B3360; border-radius: 32px; flex-direction: column; justify-content: center; align-items: center; display: inline-flex">
                    <div style="flex-direction: column; justify-content: center; align-items: center; display: flex">
                        <div style="justify-content: flex-start; align-items: flex-start; gap: 8px; display: inline-flex">
                            <div style="color: white; font-size: 16px; font-family: Sarabun; font-weight: 700; line-height: 24px; word-wrap: break-word">Satisfied, the model is human-centric</div>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <!-- Left side content - Trial display with radar chart -->
        <div style="width: 659px; height: 870px; left: 100px; top: 77px; position: absolute; box-shadow: 0px 6px 40px rgba(56.52, 119.95, 178.50, 0.08); border-radius: 24px; background-color: #D9D9D9; overflow: hidden; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;">
            <h2 style="text-align: center; margin: 0 0 15px 0; color: #333; font-size: 24px;">
                Trial <span id="trialNumber">1</span> - <span id="stakeType">High</span> Stake
            </h2>
            
            <!-- Radar Chart Container -->
            <div style="flex: 1; min-height: 0; position: relative;">
                <canvas id="radarChart" style="width: 100%; height: 100%; display: block;"></canvas>
            </div>
            
            <!-- Trial Details -->
            <div style="margin-top: 20px; padding: 15px; background: rgba(255, 255, 255, 0.7); border-radius: 12px; font-size: 14px;">
                <p><strong>Participant ID:</strong> <span id="participantId">1001</span></p>
                <p><strong>Time Spent:</strong> <span id="timeSpent">5</span> seconds</p>
                <p><strong>Chosen Robot:</strong> <span id="chosenRobot">Robot 2</span></p>
            </div>
        </div>
    </div>
</div>

<!-- Load required libraries -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>

<!-- Previous HTML content remains the same until the script section -->
<script>
// Trial data from CSV
const csvData = `trial,participantid,datetime,staketype,choice,timespent,robot1energy,robot1pace,robot1safety,robot1reliability,robot1intelligence,robot2energy,robot2pace,robot2safety,robot2reliability,robot2intelligence,robot3energy,robot3pace,robot3safety,robot3reliability,robot3intelligence
1,1001,20250410120000,high,1,5,0.65,0.55,0.7,0.6,0.58,0.75,0.45,0.8,0.65,0.62,0.5,0.6,0.65,0.55,0.5
2,1001,20250410120001,low,3,3,0.55,0.45,0.6,0.5,0.48,0.7,0.35,0.75,0.6,0.57,0.45,0.55,0.6,0.5,0.45
3,1001,20250410120002,high,3,7,0.6,0.5,0.65,0.55,0.53,0.65,0.4,0.7,0.55,0.6,0.55,0.65,0.7,0.6,0.55
4,1002,20250410120003,low,3,4,0.7,0.6,0.75,0.65,0.63,0.8,0.5,0.85,0.7,0.67,0.6,0.7,0.75,0.65,0.6
5,1002,20250410120004,high,3,6,0.5,0.4,0.55,0.45,0.43,0.6,0.3,0.65,0.5,0.52,0.4,0.5,0.55,0.45,0.4
6,1002,20250410120005,low,3,2,0.75,0.65,0.8,0.7,0.68,0.85,0.55,0.9,0.75,0.73,0.65,0.75,0.8,0.7,0.65
7,1003,20250410120006,high,2,8,0.58,0.48,0.63,0.53,0.51,0.68,0.38,0.73,0.58,0.61,0.48,0.58,0.63,0.53,0.48
8,1003,20250410120007,low,3,5,0.62,0.52,0.67,0.57,0.55,0.72,0.42,0.77,0.62,0.65,0.52,0.62,0.67,0.57,0.52
9,1003,20250410120008,high,3,9,0.67,0.57,0.72,0.62,0.6,0.77,0.47,0.82,0.67,0.7,0.57,0.67,0.72,0.62,0.57
10,1004,20250410120009,low,3,3,0.53,0.43,0.58,0.48,0.46,0.63,0.33,0.68,0.53,0.56,0.43,0.53,0.58,0.48,0.43`;

// Parse CSV data
const trials = Papa.parse(csvData, {
    header: true,
    dynamicTyping: true,
    skipEmptyLines: true
}).data;

// State management
let currentTrialIndex = 0;
const userRatings = [];
let radarChart = null;
let trialStartTime = null;

// Initialize the page with first trial
window.addEventListener('load', function() {
    displayTrial(currentTrialIndex);
});

// Display a specific trial
function displayTrial(index) {
    const trial = trials[index];
    trialStartTime = new Date(); // Record when the trial was displayed
    
    // Update trial info
    document.getElementById('trialNumber').textContent = trial.trial;
    document.getElementById('trialCounter').textContent = `${index + 1}/${trials.length}`;
    document.getElementById('stakeType').textContent = trial.staketype.charAt(0).toUpperCase() + trial.staketype.slice(1);
    document.getElementById('participantId').textContent = trial.participantid;
    document.getElementById('timeSpent').textContent = trial.timespent;
    document.getElementById('chosenRobot').textContent = `Robot ${trial.choice}`;
    document.getElementById('satisfactionPrompt').textContent = `How satisfied are you with this ${trial.staketype.toUpperCase()} stake robot pairing? Consider how well it fits your decision in this context.`;
    
    // Prepare radar chart data
    const attributes = ['Energy', 'Pace', 'Safety', 'Reliability', 'Intelligence'];
    
    // Get data for all three robots
    const robotData = [1, 2, 3].map(robotNum => {
        return attributes.map(attr => {
            const attrKey = `robot${robotNum}${attr.toLowerCase()}`;
            return trial[attrKey];
        });
    });
    
    // Highlight the chosen robot with a different color
    const backgroundColors = [
        'rgba(255, 99, 132, 0.2)',
        'rgba(54, 162, 235, 0.2)',
        'rgba(75, 192, 192, 0.2)'
    ];
    
    const borderColors = [
        'rgb(255, 99, 132)',
        'rgb(54, 162, 235)',
        'rgb(75, 192, 192)'
    ];
    
    // Make the chosen robot more prominent
    backgroundColors[trial.choice - 1] = 'rgba(153, 102, 255, 0.5)';
    borderColors[trial.choice - 1] = 'rgb(153, 102, 255)';
    
    // Create or update radar chart
    const ctx = document.getElementById('radarChart').getContext('2d');
    
    if (radarChart) {
        radarChart.destroy();
    }
    
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: attributes,
            datasets: [
                {
                    label: 'Robot 1',
                    data: robotData[0],
                    backgroundColor: backgroundColors[0],
                    borderColor: borderColors[0],
                    pointBackgroundColor: borderColors[0],
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                },
                {
                    label: 'Robot 2',
                    data: robotData[1],
                    backgroundColor: backgroundColors[1],
                    borderColor: borderColors[1],
                    pointBackgroundColor: borderColors[1],
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                },
                {
                    label: 'Robot 3',
                    data: robotData[2],
                    backgroundColor: backgroundColors[2],
                    borderColor: borderColors[2],
                    pointBackgroundColor: borderColors[2],
                    borderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    min: 0,
                    max: 1,
                    ticks: {
                        stepSize: 0.2,
                        backdropColor: 'rgba(0, 0, 0, 0)'
                    },
                    angleLines: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    pointLabels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: {
                            size: 12,
                            weight: 'bold'
                        },
                        padding: 20
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ' + context.raw.toFixed(2);
                        }
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.1
                }
            }
        }
    });
}

// Handle satisfaction rating
function rateSatisfaction(rating) {
    const currentTrial = trials[currentTrialIndex];
    
    // Calculate actual elapsed time in seconds
    const trialEndTime = new Date();
    const elapsedTime = Math.round((trialEndTime - trialStartTime) / 1000);
    
    // Save rating for current trial along with all original data
    userRatings.push({
        trial: currentTrial.trial,
        participantid: currentTrial.participantid,
        datetime: currentTrial.datetime,
        staketype: currentTrial.staketype,
        choice: currentTrial.choice,
        timespent: elapsedTime, // Use actual elapsed time instead of original
        robot1energy: currentTrial.robot1energy,
        robot1pace: currentTrial.robot1pace,
        robot1safety: currentTrial.robot1safety,
        robot1reliability: currentTrial.robot1reliability,
        robot1intelligence: currentTrial.robot1intelligence,
        robot2energy: currentTrial.robot2energy,
        robot2pace: currentTrial.robot2pace,
        robot2safety: currentTrial.robot2safety,
        robot2reliability: currentTrial.robot2reliability,
        robot2intelligence: currentTrial.robot2intelligence,
        robot3energy: currentTrial.robot3energy,
        robot3pace: currentTrial.robot3pace,
        robot3safety: currentTrial.robot3safety,
        robot3reliability: currentTrial.robot3reliability,
        robot3intelligence: currentTrial.robot3intelligence,
        userSatisfaction: rating
    });
    
    // Move to next trial or finish
    currentTrialIndex++;
    
    if (currentTrialIndex < trials.length) {
        displayTrial(currentTrialIndex);
    } else {
        // All trials completed - download results
        downloadResults();
        
        // Show completion message
        alert('Thank you for rating all trials! Your results have been downloaded.');
    }
}

// Download results as CSV with original headers plus satisfaction
function downloadResults() {
    const now = new Date();
    const dateTime = now.toISOString().replace(/[:.]/g, '-').split('T').join('_');
    
    // Prepare CSV header - maintain original headers plus satisfaction
    let csvContent = "trial,participantid,datetime,staketype,choice,timespent,robot1energy,robot1pace,robot1safety,robot1reliability,robot1intelligence,robot2energy,robot2pace,robot2safety,robot2reliability,robot2intelligence,robot3energy,robot3pace,robot3safety,robot3reliability,robot3intelligence,userSatisfaction\n";
    
    // Add each rating with all original data
    userRatings.forEach(rating => {
        csvContent += [
            rating.trial,
            rating.participantid,
            rating.datetime,
            rating.staketype,
            rating.choice,
            rating.timespent,
            rating.robot1energy,
            rating.robot1pace,
            rating.robot1safety,
            rating.robot1reliability,
            rating.robot1intelligence,
            rating.robot2energy,
            rating.robot2pace,
            rating.robot2safety,
            rating.robot2reliability,
            rating.robot2intelligence,
            rating.robot3energy,
            rating.robot3pace,
            rating.robot3safety,
            rating.robot3reliability,
            rating.robot3intelligence,
            rating.userSatisfaction
        ].join(',') + '\n';
    });
    
    // Create and download CSV
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `RobotChoiceRatings-${dateTime}.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}
</script>